<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>Blog Single Sidebar - EduGrids Education & Online Course HTML Template.</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favicon.svg">
    <!-- Place favicon.ico in the root directory -->

    <!-- Web Font -->
    <link href="../../css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/LineIcons.2.0.css">
    <link rel="stylesheet" href="assets/css/animate.css">
    <link rel="stylesheet" href="assets/css/tiny-slider.css">
    <link rel="stylesheet" href="assets/css/glightbox.min.css">
    <link rel="stylesheet" href="assets/css/main.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-lite.min.css" rel="stylesheet">


    <link  href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet" />

</head>

<body>
    <!--[if lte IE 9]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="https://browsehappy.com/">upgrade your browser</a> to improve
        your experience and security.
      </p>
    <![endif]-->

    <!-- Preloader -->
    <header class="header style2 navbar-area">
        <div id="navbar-container"></div>
    </header>
    <!-- Start Blog Singel Area -->
    <section class="section blog-single">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-12">
                    <div class="single-inner">
                        <div class="post-thumbnils">
                            <img id="headerimage" src="[image]" alt="#">
                        </div>
                        <div class="form-group">
                                <label>Header Photo</label>
                                <input type="file" id="inputImage" accept="image/*">
                                <input type="hidden" id="croppedImageData" name="croppedImageData">

                                <div id="cropContainer" style="margin-top: 15px; display: none;">
                                    <img id="previewImage" style="max-width: 100%; max-height: 400px;" />
                                    <br>
                                    <button type="button" class="btn btn-sm btn-primary mt-2" id="cropBtn">Crop Sekarang</button>
                                </div>

                                <div id="croppedPreview" style="margin-top: 15px; display: none;">
                                    <label>Hasil Crop:</label>
                                    <img id="croppedImagePreview" style="max-width: 100%;" />
                                </div>
                            </div>
                        <div class="post-details">
                            <div class="detail-inner">
                                <!-- post meta -->
                                <ul class="custom-flex post-meta">
                                    <li>
                                        <a href="javascript:void(0)">
                                            <i class="lni lni-calendar"></i>
                                            [tanggal]
                                        </a>
                                    </li>
                                </ul>
                                <h2 class="post-title">
                                    <a href="javascript:void(0)">[judul]</a>
                                </h2>

                                <div>
                                  <div class="btn-group mb-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="insertParagraph()">Konten</button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="insertSubJudul()">Sub Judul</button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="insertList()">List</button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="insertQuote()">Quote</button>
                                  </div>

                                    <textarea id="summernote">
                                        Place <em>some</em> <u>text</u> <strong>here</strong>
                                    </textarea>
                                </div>
                                <p><br></p>
                                <div class="post-tags-media">

                                    <div class="post-social-media" style="text-align: left;">
                                        <h5 class="share-title">Informasi lain</h5>
                                        <div class="form-group">
                                            <label>Deskripsi Page</label>
                                            <input class="margin-5px-bottom" type="text" id="deskripsi" placeholder="Deskripsi Halaman">
                                        </div>
                                        <div class="button">
                                            <button id="saveBtn" type="submit" class="btn">Edit Page </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Comments -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- End Blog Singel Area -->

    <!-- Start Footer Area -->
    <footer class="footer style2">
        <!-- Start Middle Top -->
        <div class="footer-middle">
            <div class="container">
                <div class="row">
                    <div class="col-lg-4 col-md-4 col-12">
                        <!-- Single Widget -->
                        <div class="f-about single-footer">
                            <div class="logo">
                                <a href="index.html"><img src="assets/images/logo/logo.svg" alt="Logo"></a>
                            </div>
                            <p>Nemo enim enim voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia
                                consequ magni dolores eos qui ratione.</p>
                            <div class="footer-social">
                                <ul>
                                    <li><a href="javascript:void(0)"><i class="lni lni-facebook-original"></i></a></li>
                                    <li><a href="javascript:void(0)"><i class="lni lni-twitter-original"></i></a></li>
                                    <li><a href="javascript:void(0)"><i class="lni lni-linkedin-original"></i></a></li>
                                    <li><a href="javascript:void(0)"><i class="lni lni-google"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <!-- End Single Widget -->
                    </div>
                    <div class="col-lg-8 col-md-8 col-12">
                        <div class="row">
                            <div class="col-lg-4 col-md-6 col-12">
                                <!-- Single Widget -->
                                <div class="single-footer sm-custom-border f-link">
                                    <h3>Pages</h3>
                                    <ul>
                                        <li><a href="javascript:void(0)">Privacy Policy</a></li>
                                        <li><a href="javascript:void(0)">Terms & Conditions</a></li>
                                        <li><a href="javascript:void(0)">Support Team</a></li>
                                        <li><a href="javascript:void(0)">Our Advisor</a></li>
                                        <li><a href="javascript:void(0)">Return Policy</a></li>
                                    </ul>
                                </div>
                                <!-- End Single Widget -->
                            </div>
                            <div class="col-lg-4 col-md-6 col-12">
                                <!-- Single Widget -->
                                <div class="single-footer sm-custom-border f-link">
                                    <h3>Courses</h3>
                                    <ul>
                                        <li><a href="javascript:void(0)">Web Design</a></li>
                                        <li><a href="javascript:void(0)">Graphics Desing</a></li>
                                        <li><a href="javascript:void(0)">App Development</a></li>
                                        <li><a href="javascript:void(0)">CPA Marketing</a></li>
                                        <li><a href="javascript:void(0)">Digital Marketing</a></li>
                                    </ul>
                                </div>
                                <!-- End Single Widget -->
                            </div>
                            <div class="col-lg-4 col-md-12 col-12">
                                <!-- Single Widget -->
                                <div class="single-footer footer-newsletter">
                                    <h3>Newsletter</h3>
                                    <p>Subscribe to us to always stay in touch with us.</p>
                                    <form action="mail/mail.php" method="get" target="_blank" class="newsletter-form">
                                        <input name="EMAIL" placeholder="Your email address" class="common-input" onfocus="this.placeholder = ''" onblur="this.placeholder = 'Your email address'" required="" type="email">
                                        <div class="button">
                                            <button class="btn">Subscribe Now!</button>
                                        </div>
                                    </form>
                                </div>
                                <!-- End Single Widget -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--/ End Footer Middle -->
        <!-- Start Footer Bottom -->
        <div class="footer-bottom">
            <div class="container">
                <div class="inner">
                    <div class="row">
                        <div class="col-12">
                            <div class="left">
                                <p>Designed and Developed by<a href="https://graygrids.com/" rel="nofollow" target="_blank">GrayGrids</a></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Footer Middle -->
    </footer>
    <!--/ End Footer Area -->

    <!-- ========================= scroll-top ========================= -->
    <a href="#" class="scroll-top btn-hover">
        <i class="lni lni-chevron-up"></i>
    </a>

    <!-- ========================= JS here ========================= -->
         <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     <script src="assets/js/bootstrap.min.js"></script>

    <script src="assets/js/count-up.min.js"></script>
    <script src="assets/js/wow.min.js"></script>
    <script src="assets/js/tiny-slider.js"></script>
    <script src="assets/js/glightbox.min.js"></script>
    <script src="assets/js/main.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.20/summernote-lite.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <!-- Supabase Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
  const SUPABASE_URL = 'https://oildpbwnyayfdshnjujp.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9pbGRwYndueWF5ZmRzaG5qdWpwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwNTAzOTgsImV4cCI6MjA2OTYyNjM5OH0.dPPvWAoRhn2AZzYIDgWRubg5YE0xDnNSFTL4zmbPX1w';
  const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const id = new URLSearchParams(window.location.search).get('id');
  console.log('ID dari URL:', id);

  document.addEventListener('DOMContentLoaded', async () => {
    if (!id) {
      alert('ID tidak ditemukan di URL');
      return;
    }

    const { data, error } = await supabaseClient
      .from('tour2025')
      .select('*')
      .eq('id', id)
      .single();

    if (error || !data) {
      alert('Data tidak ditemukan');
      console.error('ERROR saat fetch data:', error);
      return;
    }

    console.log('Data awal:', data);

    // Tampilkan data ke elemen HTML
    document.getElementById('headerimage').src = `${SUPABASE_URL}/storage/v1/object/public/headerimg/${data.header_img || ''}`;
    document.getElementById('deskripsi').value = data.deskripsi || '';
    document.querySelector('.post-title a').textContent = data.judul || '[judul]';
    document.querySelector('.lni-calendar').nextSibling.textContent = ' ' + (data.tanggal || '[tanggal]');

    $('#summernote').summernote({ height: 300 });
    $('#summernote').summernote('code', data.konten || '');

    document.getElementById('croppedImageData').value = data.header_img || '';

    // Fungsi untuk tombol simpan
document.getElementById('saveBtn').addEventListener('click', async () => {
  const konten = $('#summernote').summernote('code');
  const deskripsi = document.getElementById('deskripsi').value;
  const croppedImage = document.getElementById('croppedImageData').value;

  let imagePath = '';

  if (croppedImage.startsWith('data:image')) {
    // Buat nama file unik
    const fileName = `header_${Date.now()}.jpg`;

    try {
      const imageBlob = await (await fetch(croppedImage)).blob();

      const { data: uploadData, error: uploadError } = await supabaseClient
        .storage
        .from('headerimg')
        .upload(fileName, imageBlob, {
          contentType: 'image/jpeg',
          upsert: true // jika perlu timpa file lama
        });

      if (uploadError) {
        console.error('Gagal upload gambar:', uploadError);
        alert('Upload gambar gagal');
        return;
      }

      console.log('Upload berhasil:', uploadData);
      imagePath = uploadData.path;

    } catch (err) {
      console.error('Fetch Blob Error:', err);
      alert('Gagal konversi gambar');
      return;
    }

  } else {
    // Jika bukan gambar baru, gunakan nilai lama
    imagePath = croppedImage;
  }

  // Logging sebelum update
  console.log('Data yang akan diupdate:', {
    konten,
    deskripsi,
    header_img: imagePath
  });

  const { data: updatedData, error: updateError } = await supabaseClient
    .from('tour2025')
    .update({
      konten,
      deskripsi,
      header_img: imagePath
    })
    .eq('id', id)
    .select();

  if (updateError) {
    alert('Gagal menyimpan');
    console.error('Update error:', updateError);
  } else {
    console.log('Data setelah update:', updatedData);
    alert('Berhasil disimpan!');
  }
});

  });
</script>


<!-- AdminLTE for demo purposes -->
<script>
  function insertParagraph() {
    $('#summernote').summernote('pasteHTML', '<p>Masukkan konten di sini...</p>');
  }

  function insertSubJudul() {
    $('#summernote').summernote('pasteHTML', '<h3>Sub Judul</h3>');
  }

  function insertList() {
    const html = `
      <ul class="list">
        <li><i class="lni lni-chevron-right-circle"></i> Item 1</li>
        <li><i class="lni lni-chevron-right-circle"></i> Item 2</li>
      </ul>`;
    $('#summernote').summernote('pasteHTML', html);
  }

  function insertQuote() {
    const html = `
      <blockquote>
        <div class="icon">
          <i class="lni lni-quotation"></i>
        </div>
        <h4>Text</h4>
        <span>Epictetus, The Enchiridion</span>
      </blockquote>`;
    $('#summernote').summernote('pasteHTML', html);
  }
</script>

<script>
  let cropper;

  document.getElementById('inputImage').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (event) {
      const img = document.getElementById('previewImage');
      img.src = event.target.result;
      document.getElementById('cropContainer').style.display = 'block';

      if (cropper) cropper.destroy();

      cropper = new Cropper(img, {
        aspectRatio: 16 / 9,
        viewMode: 1,
        autoCropArea: 1
      });
    };
    reader.readAsDataURL(file);
  });

  document.getElementById('cropBtn').addEventListener('click', function () {
    if (cropper) {
      const canvas = cropper.getCroppedCanvas({
        width: 1600,
        height: 900,
        imageSmoothingEnabled: true,
        imageSmoothingQuality: 'high'
      });

      const croppedDataURL = canvas.toDataURL('image/jpeg', 0.95); // kualitas tinggi
      document.getElementById('croppedImageData').value = croppedDataURL;

      // Tampilkan hasil crop di preview
      document.getElementById('croppedImagePreview').src = croppedDataURL;
      document.getElementById('croppedPreview').style.display = 'block';
      document.getElementById('cropContainer').style.display = 'none';
    }
  });
</script>

    <script>
        // Fungsi untuk memuat file HTML ke dalam elemen
        function loadHTML(elementId, filePath) {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', filePath, true);
            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    document.getElementById(elementId).innerHTML = xhr.responseText;

                    // Jalankan highlight hanya setelah navbar dimuat
                    if (filePath.includes('navbar.html')) {
                        highlightActiveLink();
                    }
                }
            };
            xhr.send();
        }

        // Fungsi untuk menandai link navbar yang aktif
        function highlightActiveLink() {
            const pageCode = document.body.getAttribute('data-page');
            if (!pageCode) return;

            const navLinks = document.querySelectorAll('#nav a');

            navLinks.forEach(link => {
                const target = link.getAttribute('data-target');
                if (target === pageCode) {
                    link.classList.add('active');
                    const parentItem = link.closest('.nav-item');
                    if (parentItem) parentItem.classList.add('active-parent');
                } else {
                    link.classList.remove('active');
                }
            });
        }

        // Load awal
        loadHTML('navbar-container', 'menu/navbar.html');
        loadHTML('toolbar-container', 'menu/toolbar.html');
        loadHTML('footer-container', 'menu/footer.html');

        // Fungsi memuat konten ke dalam #content-container
        function loadContent(filePath) {
            loadHTML('content-container', filePath);
        }
    </script>

</body>

</html>